name: CI - Secret scan

on:
  pull_request:
  push:
  workflow_dispatch: {}

jobs:
  secret-scan:
    name: Secret scan (grep)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install ripgrep
        run: |
          sudo apt-get update -y && sudo apt-get install -y ripgrep || true

      - name: Run secret scan
        id: scan
        run: |
          set -euo pipefail
          mkdir -p secret-scan
          REPORT=secret-scan/report.txt
          echo "Scanning repository for common secret literals..."
          # Patterns to detect (add more if needed)
          PATTERNS='Password:'
          if command -v rg >/dev/null 2>&1 ; then
            rg -n --hidden --no-ignore -S "$PATTERNS" . > $REPORT || true
          else
            # fallback to grep
            grep -RIn --exclude-dir=.git -E "$PATTERNS" . > $REPORT || true
          fi
          if [ -s "$REPORT" ]; then
            echo "Found potential secrets:"; cat "$REPORT"; exit 1
          else
            echo "No obvious secret literals found"
          fi

      - name: Upload secret-scan report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: secret-scan-report
          path: secret-scan/


